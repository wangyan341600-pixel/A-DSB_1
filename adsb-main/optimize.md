# ADS-B 雷达监控系统 UI/UX 优化记录

**记录时间**：2025年12月19日 15:30

---

## 一、模式指示器优化

### 1.1 修改文件
- `src/components/Map.vue`

### 1.2 修改内容
- 在顶部导航栏 `header-right` 区域添加模式指示器组件
- 根据当前模式（simulation/recording/replay）显示不同样式的徽章
- 新增对应的CSS动画样式

### 1.3 效果
- **模拟模式**：蓝色背景 + 📡 雷达图标旋转动画
- **录制模式**：红色背景 + 🔴 脉冲动画 + "REC" 闪烁标签 + 边框呼吸发光
- **回放模式**：绿色背景 + ▶️ 弹跳动画 + 实时播放时间显示

---

## 二、关闭回放面板返回模拟模式

### 2.1 修改文件
- `src/components/Map.vue`

### 2.2 修改内容
- 新增 `closeReplayPanel()` 函数，关闭浮窗时自动调用 `backToSimulation()`
- 修改关闭按钮的事件绑定

### 2.3 效果
关闭"数据回放控制"浮窗时，无论当前处于什么模式，都会立即返回模拟模式。

---

## 三、停止回放保留当前界面状态

### 3.1 修改文件
- `src/components/Map.vue`
- `src/utils/recorder.ts`

### 3.2 修改内容
- 修改 `recorder.ts` 中的 `stop()` 方法，增加 `preserveState` 参数
- 修改 `Map.vue` 中的 `stopReplay()` 函数，传入 `true` 保留状态

### 3.3 效果
- 点击"停止"按钮时，飞机位置和轨迹保持不变
- 界面保持在当前时间点的状态
- 可以继续点击"播放"从当前位置恢复播放

---

## 四、回放模式只显示录制文件中的飞机

### 4.1 修改文件
- `src/components/Map.vue`

### 4.2 修改内容
- 修改 `loadRecordingFile()` 函数
- 移除恢复 `truthAircrafts` 的代码
- 确保停止所有模拟源（前端定时器 + Rust 后端）
- 清空所有现有状态后再进入回放模式

### 4.3 效果
- 加载录制文件后，地图清空
- 回放时只显示录制文件中的飞机数据
- 不会与模拟模式的飞机混淆

---

## 五、停止后点击播放继续播放（而非从头开始）

### 5.1 修改文件
- `src/utils/recorder.ts`

### 5.2 修改内容
- 修改 `play()` 方法的判断条件
- 增加对 `idle` 状态但 `pausedAt > 0` 的情况处理

### 5.3 效果
- 点击"停止"后，`pausedAt` 保存当前播放位置
- 再次点击"播放"时，从保存的位置继续播放
- 只有在完全重置后才会从头开始

---

## 六、回放模式数据源显示优化

**记录时间**：2025年12月19日 16:15

### 6.1 修改文件
- `src/components/Map.vue`

### 6.2 问题描述
1. 回放时数据源显示不正确
2. 关闭浮窗后数据源没有恢复到之前的状态

### 6.3 修改内容
- 右上角数据源徽章支持回放模式显示"📼 录制回放"
- 左侧雷达状态数据源显示支持回放模式
- 新增 `previousDataSource` 变量保存进入回放前的数据源状态
- 修改 `backToSimulation()` 为异步函数，根据之前的数据源恢复

### 6.4 效果
| 场景 | 修改前 | 修改后 |
|------|--------|--------|
| 回放模式 - 右上角徽章 | 显示"前端模拟" | 显示"📼 录制回放" |
| 回放模式 - 左侧雷达状态 | 显示"前端模拟" | 显示"录制回放" |
| Rust后端 → 回放 → 关闭浮窗 | 变为"前端模拟" | 恢复"Rust后端" |

---

## 七、态势显示与目标列表功能差异化

**记录时间**：2025年12月19日 16:45

### 7.1 修改文件
- `src/components/Map.vue`

### 7.2 问题描述
导航栏上的"态势显示"和"目标列表"两个功能按钮点击后界面没有变化。

### 7.3 修改内容
- 新增视图切换函数 `switchToMapView()` 和 `switchToPlanesView()`
- 态势显示模式自动隐藏左侧面板，显示右上角统计和底部快速目标列表
- 目标列表模式自动显示左侧面板
- 新增 `selectAndFocusPlane()` 函数实现点击定位
- 新增对应的CSS样式

### 7.4 效果
| 功能 | 态势显示模式 | 目标列表模式 |
|------|-------------|-------------|
| 左侧面板 | 自动隐藏 | 自动显示 |
| 右上角信息 | 显示实时统计 | 无 |
| 底部快速列表 | 显示目标 | 无 |
| 适用场景 | 整体态势监控 | 详细目标管理 |

---

## 八、态势显示底部目标列表优化

**记录时间**：2025年12月19日 17:05

### 8.1 修改文件
- `src/components/Map.vue`

### 8.2 问题描述
底部快速目标列表只显示前10个飞机，且数量与地图上显示的飞机不一致。

### 8.3 修改内容
- 新增按 NIC 排序的计算属性 `planesListByNic`
- 移除数量限制，显示全部飞机
- 添加标题栏显示目标总数和排序说明
- 优化滚动样式

### 8.4 效果
| 改进项 | 修改前 | 修改后 |
|--------|--------|--------|
| 显示数量 | 仅前10个 | 全部飞机 |
| 排序方式 | 按最近更新 | 按信号质量(NIC)从高到低 |
| 数据一致性 | 与地图不一致 | 只显示地图上有位置的飞机 |

---

## 九、降低热力图颜色亮度

**记录时间**：2025年12月19日 21:30

### 9.1 修改文件
- `src/components/Map.vue`

### 9.2 问题描述
热力图显示的颜色累积多了会显得地图很亮。

### 9.3 修改内容
修改 `createHeatmapLayer()` 函数中的渐变色配置：
- 中心点透明度降低60%
- 饱和度和亮度降低

### 9.4 效果
热力图累积时更加柔和，不会使地图过亮。

---

## 十、飞机锁定跟踪功能

**记录时间**：2025年12月19日 17:35

### 10.1 修改文件
- `src/components/Map.vue`

### 10.2 问题描述
用户希望点击飞机时，地图上出现红框锁定并跟随飞机移动。

### 10.3 修改内容
- 新增状态变量 `lockedPlaneId` 和 `lockBoxMarker`
- 新增锁定框相关函数：`createLockBoxIcon()`、`updateLockBox()`、`removeLockBox()`
- 修改 `selectAndFocusPlane()` 和 `updateMap()` 函数支持锁定跟随
- 修改底部目标列表显示锁定状态
- 新增锁定框CSS样式

### 10.4 效果
| 功能 | 说明 |
|------|------|
| 锁定飞机 | 点击目标列表中的飞机，地图上显示红色锁定框 |
| 自动跟随 | 地图持续跟随锁定飞机移动，飞机始终在中心 |
| 取消锁定 | 再次点击同一飞机可取消锁定 |
| 视觉反馈 | 地图红框+底部列表🔒图标+红色高亮 |

---

## 十一、修复切换飞机时地图未完整加载问题

**记录时间**：2025年12月19日 17:40

### 11.1 修改文件
- `src/components/Map.vue`

### 11.2 问题描述
切换锁定飞机时，软件右边有一块地图没有加载出来。

### 11.3 修改内容
修改 `selectAndFocusPlane()` 函数，在地图移动后延迟调用 `map.invalidateSize()` 刷新地图尺寸。

### 11.4 效果
切换锁定飞机时，地图能够完整加载，不再出现未渲染区域。

---

## 十二、统计分析功能增强

**修改时间**：2025年12月19日 22:00

### 12.1 修改文件
- `src/components/Map.vue`

### 12.2 问题描述
原有的"统计分析"功能过于简单，只显示4个基础数据，与"态势显示"功能重复。

### 12.3 修改内容

#### 新增多Tab统计分析中心
将原有简单统计面板升级为4个功能丰富的Tab页：

**📈 概览 Tab**
- 4个彩色卡片：在线目标、高精度信号、中等信号、低质量信号
- 消息统计面板：总消息数、位置消息、速度消息、最近1分钟消息数、实时消息频率
- NIC质量分布饼图：动态conic-gradient显示信号质量比例分布

**✈️ 飞行数据 Tab**
- 6个迷你统计卡片：平均高度、最大高度、最小高度、平均速度、最大速度、最小速度
- 高度分布柱状图：按高度区间统计
- 速度分布柱状图：按速度区间统计

**📶 信号分析 Tab**
- 环形仪表盘：显示信号优良率百分比
- 信号质量条形图：优秀/良好/较差三档分布
- 信号详情表格：按NIC排序显示前10架飞机详情

**🏢 航空公司 Tab**
- 航空公司数量和总航班数统计
- 航空公司列表：显示Logo、名称、航班数量、平均NIC值
- 支持识别多种航空公司代码

#### 新增计算属性
- `statsActiveTab`: 统计分析当前Tab状态
- `messageStats`: 消息统计追踪
- `flightStats`: 飞行统计
- `altitudeDistribution`: 高度分布统计
- `speedDistribution`: 速度分布统计
- `nicDistribution`: NIC信号质量分布
- `nicPieChartStyle`: 饼图动态样式
- `airlineStats`: 航空公司统计

#### 消息统计实时追踪
在 `handleReceivedMessage` 函数中调用 `updateMessageStats()` 实时统计

#### NIC饼图动态比例显示
- 修复饼图只显示红色的问题
- 使用计算属性动态生成 conic-gradient
- 根据优秀/良好/较差的实际数量比例分配颜色

### 12.4 效果
- 统计分析功能升级为专业的多维度数据分析中心
- 支持Tab切换查看不同维度的统计数据
- 实时数据动态更新，图表响应式展示
- NIC饼图正确按比例显示不同信号质量的分布

---

## 完整修改总结

| 序号 | 优化项 | 涉及文件 | 状态 |
|------|--------|----------|------|
| 1 | 顶部导航栏模式指示器 | Map.vue | ✅ 完成 |
| 2 | 关闭浮窗返回模拟模式 | Map.vue | ✅ 完成 |
| 3 | 停止回放保留状态 | Map.vue, recorder.ts | ✅ 完成 |
| 4 | 回放只显示录制飞机 | Map.vue | ✅ 完成 |
| 5 | 停止后继续播放 | recorder.ts | ✅ 完成 |
| 6 | 回放模式数据源显示优化 | Map.vue | ✅ 完成 |
| 7 | 态势显示与目标列表差异化 | Map.vue | ✅ 完成 |
| 8 | 态势显示底部目标列表优化 | Map.vue | ✅ 完成 |
| 9 | 降低热力图颜色亮度 | Map.vue | ✅ 完成 |
| 10 | 飞机锁定跟踪功能 | Map.vue | ✅ 完成 |
| 11 | 修复切换飞机时地图未加载问题 | Map.vue | ✅ 完成 |
| 12 | 统计分析功能增强 | Map.vue | ✅ 完成 |
