# ADS-B 数据回放功能 - 测试指南

## 🧪 测试用例清单

### 1. 录制功能测试

#### 测试用例 1.1: 基本录制流程
**步骤**:
1. 启动应用，等待模拟器生成飞机
2. 点击"🔴 开始录制"按钮
3. 观察界面状态变为"🔴 正在录制"
4. 等待 30 秒
5. 点击"💾 停止并下载"按钮

**预期结果**:
- 录制期间，右侧日志显示接收到的信号
- 下载一个 JSON 文件（`adsb-recording-xxxxx.json`）
- 文件大小应大于 10KB
- 控制面板状态恢复为"🟢 模拟模式"

**验证点**:
- [ ] 录制按钮状态切换正常
- [ ] JSON 文件格式正确
- [ ] 文件包含 `version`, `events`, `mapConfig` 字段
- [ ] `events` 数组长度 > 0

---

#### 测试用例 1.2: 长时间录制
**步骤**:
1. 点击"🔴 开始录制"
2. 等待 5 分钟
3. 点击"⏹️ 停止录制"（不下载）

**预期结果**:
- 系统稳定运行，无内存泄漏
- 日志中显示录制事件数量（应 > 1000）
- 数据保存到 LocalStorage

**验证点**:
- [ ] 浏览器控制台无错误
- [ ] 页面不卡顿
- [ ] 可以在 LocalStorage 中找到录制数据

---

### 2. 回放功能测试

#### 测试用例 2.1: 加载并播放录制
**步骤**:
1. 准备一个录制文件（30秒以上）
2. 点击"📂 加载录制文件"
3. 选择录制文件
4. 等待加载完成
5. 点击"▶️ 播放"

**预期结果**:
- 界面切换为"▶️ 回放模式"
- 地图清空并显示回放数据
- 飞机按时间顺序出现在地图上
- 右侧日志显示解码的信号
- 进度条平滑增长

**验证点**:
- [ ] 文件加载成功
- [ ] 飞机图标正确显示
- [ ] 热力图正确渲染
- [ ] 进度条与时间显示一致

---

#### 测试用例 2.2: 播放控制功能
**步骤**:
1. 加载录制文件并播放
2. 播放 10 秒后点击"⏸️ 暂停"
3. 等待 5 秒
4. 点击"▶️ 播放"继续
5. 拖动进度条到 50% 位置
6. 点击速度按钮切换到"2x"

**预期结果**:
- 暂停后飞机停止移动
- 继续播放后从暂停位置恢复
- 拖动进度条后跳转到对应时间点
- 2x 速度播放明显加快

**验证点**:
- [ ] 暂停/继续功能正常
- [ ] 进度条拖动精确
- [ ] 速度调整立即生效
- [ ] 时间显示准确

---

#### 测试用例 2.3: 速度切换测试
**步骤**:
1. 加载录制文件
2. 依次测试 0.5x, 1x, 2x, 4x 速度

**预期结果**:
- 0.5x: 播放速度减半，细节清晰
- 1x: 原始速度
- 2x: 播放速度加倍
- 4x: 快速浏览整个录制

**验证点**:
- [ ] 所有速度档位功能正常
- [ ] 速度切换平滑无卡顿
- [ ] 时间计算准确

---

#### 测试用例 2.4: 返回模拟模式
**步骤**:
1. 在回放模式下
2. 点击"🔄 返回模拟"

**预期结果**:
- 回放停止
- 地图清空
- 重新生成模拟飞机
- 状态切换为"🟢 模拟模式"

**验证点**:
- [ ] 状态切换正常
- [ ] 模拟器重启成功
- [ ] 无数据残留

---

### 3. 边界情况测试

#### 测试用例 3.1: 空录制文件
**步骤**:
1. 创建一个只包含初始状态的录制（录制后立即停止）
2. 加载并播放

**预期结果**:
- 加载成功
- 播放立即完成
- 系统不崩溃

---

#### 测试用例 3.2: 损坏的录制文件
**步骤**:
1. 编辑录制 JSON 文件，删除部分内容
2. 尝试加载

**预期结果**:
- 显示错误提示（控制台）
- 系统不崩溃
- 保持当前模式

---

#### 测试用例 3.3: 超大录制文件
**步骤**:
1. 录制 30 分钟以上的数据
2. 尝试下载和加载

**预期结果**:
- 下载成功（文件可能较大）
- 加载可能需要一些时间
- 播放流畅

---

### 4. 性能测试

#### 测试用例 4.1: 录制性能影响
**测试方法**:
1. 使用浏览器 Performance 工具
2. 对比录制前后的 CPU/内存使用

**预期结果**:
- CPU 增加 < 5%
- 内存增加线性增长（每秒约 1-2 KB）

---

#### 测试用例 4.2: 回放性能
**测试方法**:
1. 加载长时间录制文件
2. 使用 4x 速度播放
3. 观察 FPS 和 CPU 使用率

**预期结果**:
- FPS 保持 > 30
- 无明显卡顿
- CPU 使用率 < 60%

---

## 🔍 手动验证清单

### 数据完整性验证
- [ ] 录制文件包含所有必需字段
- [ ] 时间戳单调递增
- [ ] 回放与原始模拟行为一致
- [ ] 飞机位置、速度、高度准确还原

### UI/UX 验证
- [ ] 所有按钮状态正确（启用/禁用）
- [ ] 模式切换反馈清晰
- [ ] 进度条响应灵敏
- [ ] 日志信息有意义

### 浏览器兼容性
- [ ] Chrome (最新版)
- [ ] Firefox (最新版)
- [ ] Edge (最新版)
- [ ] Safari (最新版)

---

## 🐛 已知问题与注意事项

1. **LocalStorage 限制**: 大多数浏览器限制为 5-10MB，长时间录制建议使用下载功能
2. **时间精度**: requestAnimationFrame 精度依赖浏览器实现，可能有微小误差
3. **大文件加载**: 超大录制文件（>50MB）加载可能需要几秒钟

---

## 📈 性能基准

基于 10 架飞机、60 秒录制的性能指标：

| 指标 | 数值 |
|------|------|
| 录制文件大小 | ~50-100 KB |
| 事件数量 | ~600-1200 |
| 加载时间 | < 100ms |
| 回放 CPU 使用 | 10-20% |
| 内存占用 | ~5-10 MB |

---

## ✅ 测试通过标准

- 所有核心功能测试用例通过
- 无致命错误或崩溃
- 性能指标在可接受范围内
- 数据完整性验证通过
- UI/UX 符合预期
